C51 COMPILER V9.00   CARSTAND                                                              04/15/2016 10:09:58 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE CARSTAND
OBJECT MODULE PLACED IN .\Output\carstand.obj
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE Appcode\carstand.c LARGE BROWSE INCDIR(.\Appcode;.\BSP;.\Common;.\Driver;.\
                    -Startup;.\Common\inc;.\Driver\inc) DEBUG OBJECTEXTEND PRINT(.\Listing\carstand.lst) OBJECT(.\Output\carstand.obj)

line level    source

   1          /********************************************************************
   2          作者：Songyimiao
   3          建立日期: 20151129
   4          版本：V2.0
   5          喵呜实验室版权所有
   6          /********************************************************************/
   7          #include "includes.h"
   8          
   9          unsigned int xdata g_uiStartCount;
  10          unsigned char xdata g_ucLEDCount;
  11          unsigned char xdata g_ucIRFlag = 0;
  12          /******电机控制参数******/
  13          int   g_iCarSpeedSet;
  14          float g_fSpeedControlOut;
  15          float g_fAngleControlOut;
  16          float g_fLeftMotorOut;
  17          float g_fRightMotorOut;
  18          /******角度控制参数******/
  19          int   g_iAccelInputVoltage_X_Axis ;     //加速度X轴数据
  20          int   g_iGyroInputVoltage_Y_Axis  ;     //陀螺仪Y轴数据
  21          int   g_iGyroInputVoltage_Z_Axis  ;     //陀螺仪Y轴数据
  22          
  23          float g_fCarAngle;                              //车模倾角
  24          float g_fGyroAngleSpeed;                        //角速度                        
  25          float g_fGyroscopeAngleIntegral;        //角速度积分值
  26          float g_fGravityAngle;                          //加速度初步计算得到的倾角
  27          int g_iGyroOffset;
  28          /******速度控制参数******/
  29          int   g_iLeftMotorPulse;
  30          int   g_iRightMotorPulse;
  31          int   g_iLeftMotorPulseSigma;
  32          int   g_iRightMotorPulseSigma;
  33          float g_fCarSpeed;
  34          float g_fCarSpeedOld;
  35          float g_fCarPosition;
  36          unsigned char g_ucSpeedControlPeriod ;
  37          unsigned char g_ucSpeedControlCount ;
  38          
  39          /*-----角度环和速度环PID控制参数-----*/
  40          float code g_fcAngle_P = 90.0;           //角度环P参数
  41          float code g_fcAngle_D = 3.0;            //角度环D参数
  42          float code g_fcSpeed_P = 14.5 ;          //速度环P参数
  43          float code g_fcSpeed_I = 1.4;            //速度环D参数
  44          float code g_fcDirection_P = 300.0;      //方向环P参数
  45          float code g_fcEliminate_P= 0.0;         //短距离纠正方向环P参数  
  46          /******蓝牙控制参数******/
  47          float xdata g_fBluetoothSpeed;
  48          float xdata g_fBluetoothDirection;
  49          
  50          float xdata g_fDirectionDeviation;
  51          float xdata g_fDirectionControlOut;
  52          
  53          float xdata g_fPower;
  54          
C51 COMPILER V9.00   CARSTAND                                                              04/15/2016 10:09:58 PAGE 2   

  55          unsigned char xdata g_ucRxd2;
  56          unsigned char xdata g_ucUart2Flag;
  57          
  58          /***************************************************************
  59          ** 作　  者: Songyimiao
  60          ** 官    网：http://www.miaowlabs.com
  61          ** 淘    宝：http://miaowlabs.taobao.com
  62          ** 日　  期: 2015年11月29日
  63          ** 函数名称: DriversInit
  64          ** 功能描述: 底层驱动初始化            
  65          ** 输　  入:   
  66          ** 输　  出:   
  67          ** 备    注: 
  68          ********************喵呜实验室版权所有**************************
  69          ***************************************************************/
  70          void DriversInit(void)
  71          {
  72   1      
  73   1              GPIOInit();
  74   1              Timer1Init();
  75   1              PWMInit();
  76   1              Uart1Init();
  77   1              Uart2Init();
  78   1              Timer3Timer4Init();
  79   1              ADCInit();
  80   1      }
  81          
  82          /***************************************************************
  83          ** 作　  者: Songyimiao
  84          ** 官    网：http://www.miaowlabs.com
  85          ** 淘    宝：http://miaowlabs.taobao.com
  86          ** 日　  期: 2015年11月29日
  87          ** 函数名称: CarStandInit
  88          ** 功能描述: 直立参数初始化            
  89          ** 输　  入:   
  90          ** 输　  出:   
  91          ** 备    注: 
  92          ********************喵呜实验室版权所有**************************
  93          ***************************************************************/
  94          void CarStandInit()
  95          {
  96   1              g_iAccelInputVoltage_X_Axis = g_iGyroInputVoltage_Y_Axis = 0;
  97   1              g_iLeftMotorPulse = g_iRightMotorPulse = 0;
  98   1              g_iLeftMotorPulseSigma = g_iRightMotorPulseSigma = 0;
  99   1              g_iCarSpeedSet = 0;
 100   1      
 101   1              g_iCarSpeedSet=0;
 102   1              g_fCarSpeed    = 0;
 103   1              g_fCarSpeedOld = 0;
 104   1              g_fCarPosition = 0;
 105   1              g_fCarAngle    = 0;
 106   1              g_fGyroAngleSpeed = 0;
 107   1              g_fGravityAngle   = 0;
 108   1              g_fGyroscopeAngleIntegral = 0;
 109   1      
 110   1              g_fAngleControlOut = g_fSpeedControlOut = 0;
 111   1      
 112   1              g_fLeftMotorOut    = g_fRightMotorOut   = 0;
 113   1              g_fBluetoothSpeed  = g_fBluetoothDirection = 0;
 114   1      
 115   1          g_ucLEDCount = 0;                           
 116   1              g_uiStartCount= 0;
C51 COMPILER V9.00   CARSTAND                                                              04/15/2016 10:09:58 PAGE 3   

 117   1      
 118   1              g_fDirectionDeviation = 0;
 119   1      
 120   1              g_fPower = 0;
 121   1      
 122   1              g_ucRxd2 = g_ucUart2Flag = 0;
 123   1      }
 124          
 125          /***************************************************************
 126          ** 作　  者: Songyimiao
 127          ** 官    网：http://www.miaowlabs.com
 128          ** 淘    宝：http://miaowlabs.taobao.com
 129          ** 日　  期: 2015年11月29日
 130          ** 函数名称: DataSynthesis
 131          ** 功能描述: 数据合成函数            
 132          ** 输　  入:   
 133          ** 输　  出:   
 134          ** 备    注: 
 135          ********************喵呜实验室版权所有**************************
 136          ***************************************************************/
 137          int DataSynthesis(unsigned char REG_Address)    
 138          {
 139   1              char idata uiHighByte; /*高八位*/
 140   1              char idata ucLowByte; /*低八位*/
 141   1      
 142   1              uiHighByte = Single_ReadI2C(REG_Address)  ;
 143   1              ucLowByte  = Single_ReadI2C(REG_Address+1);
 144   1      
 145   1              return ((uiHighByte << 8) + ucLowByte);   /*返回合成数据*/
 146   1      }
 147          
 148          /***************************************************************
 149          ** 作　  者: Songyimiao
 150          ** 官    网：http://www.miaowlabs.com
 151          ** 淘    宝：http://miaowlabs.taobao.com
 152          ** 日　  期: 2015年11月29日
 153          ** 函数名称: SampleInputVoltage
 154          ** 功能描述: MPU6050采样函数            
 155          ** 输　  入:   
 156          ** 输　  出:   
 157          ** 备    注: 
 158          ********************喵呜实验室版权所有**************************
 159          ***************************************************************/
 160          void SampleInputVoltage(void)
 161          {       
 162   1      
 163   1              g_iGyroInputVoltage_Y_Axis   = DataSynthesis(GYRO_YOUT_H) ; //陀螺仪Y轴
 164   1          g_iAccelInputVoltage_X_Axis  = DataSynthesis(ACCEL_XOUT_H); //加速度X轴     
 165   1              
 166   1              g_iGyroInputVoltage_Z_Axis   = DataSynthesis(GYRO_ZOUT_H) ; //陀螺仪Y轴 
 167   1      
 168   1      }
 169          
 170          /***************************************************************
 171          ** 作　  者: Songyimiao
 172          ** 官    网：http://www.miaowlabs.com
 173          ** 淘    宝：http://miaowlabs.taobao.com
 174          ** 日　  期: 2015年11月29日
 175          ** 函数名称: GyroRevise
 176          ** 功能描述: 陀螺仪校正函数            
 177          ** 输　  入:   
 178          ** 输　  出:   
C51 COMPILER V9.00   CARSTAND                                                              04/15/2016 10:09:58 PAGE 4   

 179          ** 备    注: 
 180          ********************喵呜实验室版权所有**************************
 181          ***************************************************************/
 182          void GetGyroRevise()
 183          {
 184   1              long int tempsum;
 185   1              int temp;
 186   1              for(temp=0;temp<500;temp++)
 187   1              {
 188   2                      tempsum += DataSynthesis(GYRO_YOUT_H) ;
 189   2              }
 190   1              g_iGyroOffset = (int)(tempsum/500);
 191   1              tempsum=0;
 192   1      }
 193          
 194          /***************************************************************
 195          ** 作　  者: Songyimiao
 196          ** 官    网：http://www.miaowlabs.com
 197          ** 淘    宝：http://miaowlabs.taobao.com
 198          ** 日　  期: 2015年11月29日
 199          ** 函数名称: SetMotorVoltageAndDirection
 200          ** 功能描述: 电机设置函数            
 201          ** 输　  入:   
 202          ** 输　  出:   
 203          ** 备    注: 
 204          ********************喵呜实验室版权所有**************************
 205          ***************************************************************/
 206          void SetMotorVoltageAndDirection(int iLeftVoltage,int iRightVoltage)
 207          {
 208   1              int iLeftMotorValue;
 209   1              int iRighttMotorValue;  
 210   1      
 211   1          if(iLeftVoltage<0)
 212   1          {   
 213   2            AIN1 = 1;                               //右电机前进      角度为负  速度为正
 214   2            AIN2 = 0;
 215   2            iLeftMotorValue = (-iLeftVoltage);
 216   2          }
 217   1          else 
 218   1          {   
 219   2            AIN1 = 0;                               //右电机后退  角度为正  速度为负
 220   2            AIN2 = 1; 
 221   2            iLeftMotorValue = iLeftVoltage;
 222   2          }
 223   1      
 224   1          if(iRightVoltage<0)
 225   1          {   
 226   2            BIN1 = 1;                               //左电机前进  角度为负  速度为正
 227   2            BIN2 = 0;
 228   2            iRighttMotorValue = (-iRightVoltage);
 229   2          }
 230   1          else
 231   1          {   
 232   2            BIN1 = 0;                               //左电机后退  角度为正  速度为负
 233   2            BIN2 = 1; 
 234   2            iRighttMotorValue = iRightVoltage;
 235   2          }
 236   1      
 237   1              iLeftMotorValue   = (1000 - iLeftMotorValue)  ;    
 238   1              iRighttMotorValue = (1000 - iRighttMotorValue);
 239   1              
 240   1              PWM3T1 = iLeftMotorValue  ;  
C51 COMPILER V9.00   CARSTAND                                                              04/15/2016 10:09:58 PAGE 5   

 241   1              PWM4T1 = iRighttMotorValue;  
 242   1      
 243   1              #if IF_CAR_FALL          /*判断车辆是否跌倒，调试用*/
 244   1      
 245   1              if(g_fCarAngle > 30 || g_fCarAngle < (-30))
 246   1              {
 247   2                      AIN1 = 0;                                     //右电机前进      角度为负  速度为正
 248   2              AIN2 = 0; 
 249   2                      BIN1 = 0;                                     //右电机前进      角度为负  速度为正
 250   2              BIN2 = 0;   
 251   2              }
 252   1      
 253   1      #endif
 254   1      
 255   1      }
 256          /***************************************************************
 257          ** 作　  者: Songyimiao
 258          ** 官    网：http://www.miaowlabs.com
 259          ** 淘    宝：http://miaowlabs.taobao.com
 260          ** 日　  期: 2015年11月29日
 261          ** 函数名称: MotorOutput
 262          ** 功能描述: 电机输出函数            
 263          ** 输　  入:   
 264          ** 输　  出:   
 265          ** 备    注: 将直立控制、速度控制、方向控制的输出量进行叠加,并加
 266                                   入死区常量，对输出饱和作出处理。
 267          ********************喵呜实验室版权所有**************************
 268          ***************************************************************/
 269          void MotorOutput(void)
 270          {
 271   1      
 272   1              g_fLeftMotorOut = g_fAngleControlOut - g_fSpeedControlOut + g_fBluetoothDirection + g_fDirectionDeviation
             -;
 273   1              g_fRightMotorOut = g_fAngleControlOut - g_fSpeedControlOut - g_fBluetoothDirection - g_fDirectionDeviatio
             -n;                        
 274   1              
 275   1              /*增加死区常数*/
 276   1              if(g_fLeftMotorOut>0)       g_fLeftMotorOut  += MOTOR_OUT_DEAD_VAL;
 277   1              else if(g_fLeftMotorOut<0)  g_fLeftMotorOut  -= MOTOR_OUT_DEAD_VAL;
 278   1              if(g_fRightMotorOut>0)      g_fRightMotorOut += MOTOR_OUT_DEAD_VAL;
 279   1              else if(g_fRightMotorOut<0) g_fRightMotorOut -= MOTOR_OUT_DEAD_VAL;
 280   1      
 281   1              /*输出饱和处理是保证输出量不会超出PWM的满量程范围。*/   
 282   1              if(g_fLeftMotorOut  > MOTOR_OUT_MAX)    g_fLeftMotorOut  = MOTOR_OUT_MAX;
 283   1              if(g_fLeftMotorOut  < MOTOR_OUT_MIN)    g_fLeftMotorOut  = MOTOR_OUT_MIN;
 284   1              if(g_fRightMotorOut > MOTOR_OUT_MAX)    g_fRightMotorOut = MOTOR_OUT_MAX;
 285   1              if(g_fRightMotorOut < MOTOR_OUT_MIN)    g_fRightMotorOut = MOTOR_OUT_MIN;
 286   1      
 287   1          SetMotorVoltageAndDirection(g_fLeftMotorOut,g_fRightMotorOut);
 288   1      }
 289          
 290          
 291          /***************************************************************
 292          ** 作　  者: Songyimiao
 293          ** 官    网：http://www.miaowlabs.com
 294          ** 淘    宝：http://miaowlabs.taobao.com
 295          ** 日　  期: 2015年11月29日
 296          ** 函数名称: GetMotorPulse
 297          ** 功能描述: 捕获电机脉冲函数            
 298          ** 输　  入:   
 299          ** 输　  出:   
 300          ** 备    注: 
C51 COMPILER V9.00   CARSTAND                                                              04/15/2016 10:09:58 PAGE 6   

 301          ********************喵呜实验室版权所有**************************
 302          ***************************************************************/
 303          void GetMotorPulse(void)
 304          {
 305   1              g_iRightMotorPulse = (T4H<<8) + T4L;
 306   1              g_iLeftMotorPulse  = (T3H<<8) + T3L;
 307   1              T4T3M&= 0x77;
 308   1              T4H=T4L=0;
 309   1              T3H=T3L=0;
 310   1              T4T3M |= 0xCC;
 311   1      
 312   1              if(!MOTOR_LEFT_SPEED_POSITIVE)  g_iLeftMotorPulse  = -g_iLeftMotorPulse ; 
 313   1              if(!MOTOR_RIGHT_SPEED_POSITIVE) g_iRightMotorPulse = -g_iRightMotorPulse;
 314   1              
 315   1              g_iLeftMotorPulseSigma += g_iLeftMotorPulse;
 316   1              g_iRightMotorPulseSigma += g_iRightMotorPulse;    
 317   1      }
 318          
 319          /***************************************************************
 320          ** 作　  者: Songyimiao
 321          ** 官    网：http://www.miaowlabs.com
 322          ** 淘    宝：http://miaowlabs.taobao.com
 323          ** 日　  期: 2015年11月29日
 324          ** 函数名称: SpeedControl
 325          ** 功能描述: 速度环控制函数           
 326          ** 输　  入:   
 327          ** 输　  出:   
 328          ** 备    注: 
 329          ********************喵呜实验室版权所有**************************
 330          ***************************************************************/
 331          void SpeedControl(void)
 332          {  
 333   1              float fP, fDelta;
 334   1              float fI;
 335   1              
 336   1              g_fCarSpeed = (float)(g_iLeftMotorPulseSigma  + g_iRightMotorPulseSigma ) * 0.5f;
 337   1          g_iLeftMotorPulseSigma = g_iRightMotorPulseSigma = 0;         //全局变量 注意及时清零
 338   1      
 339   1              /*低通滤波*/ 
 340   1          g_fCarSpeed = (float)(g_fCarSpeedOld * 0.2f + g_fCarSpeed * 0.8f) ;
 341   1              g_fCarSpeedOld = g_fCarSpeed;
 342   1                                                                                                                                       
 343   1              fDelta = CAR_SPEED_SET;
 344   1              fDelta -= g_fCarSpeed;
 345   1              fP = fDelta * g_fcSpeed_P;
 346   1              fI = fDelta * g_fcSpeed_I;
 347   1              g_fCarPosition += fI;
 348   1      
 349   1              g_fCarPosition += g_fBluetoothSpeed;
 350   1      
 351   1              /*积分上限设限*/                          
 352   1              if((int)g_fCarPosition > SPEED_CONTROL_OUT_MAX)    g_fCarPosition = SPEED_CONTROL_OUT_MAX;
 353   1              if((int)g_fCarPosition < SPEED_CONTROL_OUT_MIN)    g_fCarPosition = SPEED_CONTROL_OUT_MIN;      
 354   1              
 355   1              g_fSpeedControlOut = fP + g_fCarPosition;
 356   1      
 357   1      }
 358          
 359          /***************************************************************
 360          ** 作　  者: Songyimiao
 361          ** 官    网：http://www.miaowlabs.com
 362          ** 淘    宝：http://miaowlabs.taobao.com
C51 COMPILER V9.00   CARSTAND                                                              04/15/2016 10:09:58 PAGE 7   

 363          ** 日　  期: 2015年11月29日
 364          ** 函数名称: AngleControl
 365          ** 功能描述: 角度环控制函数           
 366          ** 输　  入:   
 367          ** 输　  出:   
 368          ** 备    注: 
 369          ********************喵呜实验室版权所有**************************
 370          ***************************************************************/
 371          void AngleControl(void)  
 372          {  
 373   1              //去除零点偏移,计算得到加速度传感器的角度（弧度）
 374   1              g_fGravityAngle = (float)(g_iAccelInputVoltage_X_Axis - GRAVITY_OFFSET) / 16384.0f;
 375   1              // 57.2957795=180/3.1415926535898 弧度转换为度
 376   1              g_fGravityAngle = g_fGravityAngle * 57.2957795f ;
 377   1      
 378   1              g_fGyroAngleSpeed = (g_iGyroInputVoltage_Y_Axis - GYRO_OFFSET) / GYROSCOPE_ANGLE_RATIO *(-1);
 379   1              //互补滤波
 380   1              g_fCarAngle = 0.99f*(g_fCarAngle + g_fGyroAngleSpeed * 0.008f) + 0.01f * g_fGravityAngle;
 381   1              //角度环PID控制
 382   1              g_fAngleControlOut = (CAR_ANGLE_SET - g_fCarAngle)* g_fcAngle_P + \
 383   1              (CAR_ANGULARSPEED_SET - g_fGyroAngleSpeed )* g_fcAngle_D ;         
 384   1               
 385   1      }
 386          
 387          /***************************************************************
 388          ** 函数名称: BluetoothControl
 389          ** 功能描述: 蓝牙控制函数
 390                       手机发送内容
 391                                   前进：0x01    后退：0x02
 392                       左：  0x03    右：  0x04
 393                       停止：0x10
 394                       功能键（可自编下位机程序扩展）：
 395                       左自旋：0x07
 396                                   右自旋：0x08
 397                                   更快地前进：0x09  更慢地前进：0x0A
 398                                   更慢地后退：0x0B  更慢地后退：0x0C   巡线启动：0x0D
 399          ** 输　入:   
 400          ** 输　出:   
 401          ** 全局变量: 
 402          ** 作　者:   喵呜实验室
 403          ** 淘  宝：  Http://miaowlabs.taobao.com
 404          ** 日　期:   2014年08月01日
 405          ***************************************************************/
 406          void BluetoothControl(void)      
 407          {
 408   1              unsigned char xdata ucBluetoothValue = 0;
 409   1      
 410   1              ucBluetoothValue = g_ucRxd2;            
 411   1                      
 412   1              switch(ucBluetoothValue)
 413   1              {
 414   2      
 415   2                case 0x02 : g_fBluetoothSpeed =   40 ;  break;//后退
 416   2                case 0x01 : g_fBluetoothSpeed = (-40);  break;//前进    
 417   2                //case 0x09 : g_fBluetoothSpeed =   60;   break;//更快后退
 418   2                //case 0x0A : g_fBluetoothSpeed = (-60);  break;//更快前进
 419   2                case 0x0B : g_fBluetoothSpeed =   20;   break;
 420   2                case 0x0C : g_fBluetoothSpeed = (-20);  break;
 421   2                case 0x03 : g_fBluetoothDirection =   200 ;  break;//左转
 422   2                case 0x04 : g_fBluetoothDirection = (-200);  break;//右转
 423   2                case 0x05 : g_iCarSpeedSet =   20 ; break ;
 424   2                case 0x06 : g_iCarSpeedSet = (-20); break ;
C51 COMPILER V9.00   CARSTAND                                                              04/15/2016 10:09:58 PAGE 8   

 425   2                case 0x07 : g_fBluetoothDirection =   400 ;  break;
 426   2                case 0x08 : g_fBluetoothDirection = (-400);  break;
 427   2                case 0x0D : g_iCarSpeedSet = 8;  break;          //前进
 428   2                default : g_fBluetoothSpeed = 0; g_fBluetoothDirection = 0;g_iCarSpeedSet=0;break;
 429   2              }
 430   1      }
 431          
 432          /***************************************************************
 433          ** 作　  者: Songyimiao
 434          ** 官    网：http://www.miaowlabs.com
 435          ** 淘    宝：http://miaowlabs.taobao.com
 436          ** 日　  期: 
 437          ** 函数名称: EliminateDirectionDeviation
 438          ** 功能描述: 短距离直线纠正控制函数           
 439          ** 输　  入:   
 440          ** 输　  出:   
 441          ** 备    注: 
 442          ********************喵呜实验室版权所有**************************
 443          ***************************************************************/
 444          
 445          void EliminateDirectionDeviation(void)
 446          {
 447   1              int Delta=0;
 448   1      
 449   1              Delta = g_iLeftMotorPulseSigma - g_iRightMotorPulseSigma;
 450   1      
 451   1              g_fDirectionDeviation = Delta * g_fcEliminate_P * (-1);
 452   1      
 453   1      
 454   1      }
 455          
 456          
 457          /***************************************************************
 458          ** 作　  者: Songyimiao
 459          ** 官    网：http://www.miaowlabs.com
 460          ** 淘    宝：http://miaowlabs.taobao.com
 461          ** 日　  期: 20160408
 462          ** 函数名称: DirectionControl
 463          ** 功能描述: 红外循迹方向控制函数           
 464          ** 输　  入:   
 465          ** 输　  出:   
 466          ** 备    注: 
 467          ********************喵呜实验室版权所有**************************
 468          ***************************************************************/
 469          void DirectionControl(void)
 470          { 
 471   1        int iLeft,iRight;
 472   1        
 473   1        iLeft = LeftIR;
 474   1        iRight = RightIR;
 475   1      
 476   1        if(iLeft==0&&iRight==1)
 477   1        {
 478   2              g_fDirectionControlOut = g_fcDirection_P;       
 479   2        }
 480   1        else if(iLeft==1&&iRight==0)
 481   1        {
 482   2              g_fDirectionControlOut = (-1) * g_fcDirection_P;        
 483   2        }
 484   1        else if(iLeft==0&&iRight==0)
 485   1        {
 486   2              g_fDirectionControlOut = 0;     
C51 COMPILER V9.00   CARSTAND                                                              04/15/2016 10:09:58 PAGE 9   

 487   2        }
 488   1        else if(iLeft==1&&iRight==1)
 489   1        {
 490   2              g_fDirectionControlOut = 0;     
 491   2        }
 492   1      }
 493          
 494          /***************************************************************
 495          ** 作　  者: Songyimiao
 496          ** 官    网：http://www.miaowlabs.com
 497          ** 淘    宝：http://miaowlabs.taobao.com
 498          ** 日　  期: 20160415
 499          ** 函数名称: BatteryChecker
 500          ** 功能描述: 电量检测（若电量不足，将亮起红灯）           
 501          ** 输　  入:   
 502          ** 输　  出:   
 503          ** 备    注: 
 504          ********************喵呜实验室版权所有**************************
 505          ***************************************************************/
 506          void BatteryChecker()
 507          {
 508   1      
 509   1              g_fPower = GetADCResult();                                      //max8.4*510/(1000+510)/3.3*256=220
 510   1              g_fPower = g_fPower / 220* 8400;                         
 511   1              if((int)g_fPower <= 7400)                                               //low7.4/3=2.47v
 512   1              {
 513   2                      ON_LED1;
 514   2              }
 515   1      
 516   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2644    ----
   CONSTANT SIZE    =     24    ----
   XDATA SIZE       =     90      27
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----       2
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
